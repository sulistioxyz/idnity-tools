{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tuf/Documents/APPS/IDnity%20Tools%20v2/idnity-tools/app/api/is-website-online/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\n\r\nconst rateLimitMap = new Map<string, { count: number; lastRequest: number }>();\r\nconst LIMIT = 3; \r\nconst WINDOW_TIME = 60 * 1000; \r\n\r\nexport async function GET(request: Request) {\r\n  let visitorIp = request.headers.get('x-forwarded-for') || '127.0.0.1';\r\n  if (visitorIp.includes(',')) visitorIp = visitorIp.split(',')[0].trim();\r\n\r\n  const now = Date.now();\r\n  const userRate = rateLimitMap.get(visitorIp) || { count: 0, lastRequest: now };\r\n\r\n  if (now - userRate.lastRequest > WINDOW_TIME) {\r\n    userRate.count = 0;\r\n    userRate.lastRequest = now;\r\n  }\r\n\r\n  if (userRate.count >= LIMIT) {\r\n    const retryAfter = Math.ceil((userRate.lastRequest + WINDOW_TIME - now) / 1000);\r\n    return NextResponse.json({ error: \"Terlalu banyak permintaan.\", retryAfter }, { status: 429 });\r\n  }\r\n\r\n  const { searchParams } = new URL(request.url);\r\n  let target = searchParams.get('url')?.replace(/^https?:\\/\\//, '').split('/')[0].toLowerCase();\r\n\r\n  if (!target) return NextResponse.json({ error: \"URL tidak valid\" }, { status: 400 });\r\n\r\n  try {\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), 8000);\r\n\r\n    const res = await fetch(`https://${target}`, { \r\n      method: 'HEAD', \r\n      signal: controller.signal,\r\n      headers: { 'User-Agent': 'IDnity-Status-Checker/1.0' }\r\n    });\r\n    \r\n    clearTimeout(timeoutId);\r\n\r\n    userRate.count += 1;\r\n    rateLimitMap.set(visitorIp, userRate);\r\n\r\n    return NextResponse.json({ \r\n      online: res.ok, \r\n      status: res.status,\r\n      target \r\n    });\r\n  } catch (error) {\r\n    return NextResponse.json({ online: false, target });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,eAAe,IAAI;AACzB,MAAM,QAAQ;AACd,MAAM,cAAc,KAAK;AAElB,eAAe,IAAI,OAAgB;IACxC,IAAI,YAAY,QAAQ,OAAO,CAAC,GAAG,CAAC,sBAAsB;IAC1D,IAAI,UAAU,QAAQ,CAAC,MAAM,YAAY,UAAU,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI;IAErE,MAAM,MAAM,KAAK,GAAG;IACpB,MAAM,WAAW,aAAa,GAAG,CAAC,cAAc;QAAE,OAAO;QAAG,aAAa;IAAI;IAE7E,IAAI,MAAM,SAAS,WAAW,GAAG,aAAa;QAC5C,SAAS,KAAK,GAAG;QACjB,SAAS,WAAW,GAAG;IACzB;IAEA,IAAI,SAAS,KAAK,IAAI,OAAO;QAC3B,MAAM,aAAa,KAAK,IAAI,CAAC,CAAC,SAAS,WAAW,GAAG,cAAc,GAAG,IAAI;QAC1E,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAA8B;QAAW,GAAG;YAAE,QAAQ;QAAI;IAC9F;IAEA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,IAAI,SAAS,aAAa,GAAG,CAAC,QAAQ,QAAQ,gBAAgB,IAAI,MAAM,IAAI,CAAC,EAAE,CAAC;IAEhF,IAAI,CAAC,QAAQ,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAkB,GAAG;QAAE,QAAQ;IAAI;IAElF,IAAI;QACF,MAAM,aAAa,IAAI;QACvB,MAAM,YAAY,WAAW,IAAM,WAAW,KAAK,IAAI;QAEvD,MAAM,MAAM,MAAM,MAAM,CAAC,QAAQ,EAAE,QAAQ,EAAE;YAC3C,QAAQ;YACR,QAAQ,WAAW,MAAM;YACzB,SAAS;gBAAE,cAAc;YAA4B;QACvD;QAEA,aAAa;QAEb,SAAS,KAAK,IAAI;QAClB,aAAa,GAAG,CAAC,WAAW;QAE5B,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,QAAQ,IAAI,EAAE;YACd,QAAQ,IAAI,MAAM;YAClB;QACF;IACF,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,QAAQ;YAAO;QAAO;IACnD;AACF"}}]
}