{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tuf/Documents/APPS/IDnity%20Tools%20v2/idnity-tools/app/api/ping/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\n\r\nconst rateLimitMap = new Map<string, { count: number; lastRequest: number }>();\r\nconst LIMIT = 3; \r\nconst WINDOW_TIME = 60 * 1000; \r\n\r\nexport async function GET(request: Request) {\r\n  let visitorIp = request.headers.get('x-forwarded-for') || '127.0.0.1';\r\n  if (visitorIp.includes(',')) visitorIp = visitorIp.split(',')[0].trim();\r\n\r\n  const now = Date.now();\r\n  const userRate = rateLimitMap.get(visitorIp) || { count: 0, lastRequest: now };\r\n\r\n  if (now - userRate.lastRequest > WINDOW_TIME) {\r\n    userRate.count = 0;\r\n    userRate.lastRequest = now;\r\n  }\r\n\r\n  if (userRate.count >= LIMIT) {\r\n    const retryAfter = Math.ceil((userRate.lastRequest + WINDOW_TIME - now) / 1000);\r\n    return NextResponse.json({ error: \"Terlalu banyak permintaan.\", retryAfter }, { status: 429 });\r\n  }\r\n\r\n  const { searchParams } = new URL(request.url);\r\n  let target = searchParams.get('target')?.replace(/^https?:\\/\\//, '').split('/')[0].toLowerCase();\r\n\r\n  if (!target) return NextResponse.json({ error: \"Target tidak valid\" }, { status: 400 });\r\n\r\n  try {\r\n    const start = performance.now();\r\n    // Melakukan fetch singkat untuk mengukur waktu respon\r\n    const controller = new AbortController();\r\n    const id = setTimeout(() => controller.abort(), 5000);\r\n\r\n    await fetch(`http://${target}`, { mode: 'no-cors', signal: controller.signal }).catch(() => {});\r\n    \r\n    clearTimeout(id);\r\n    const end = performance.now();\r\n    const latency = Math.round(end - start);\r\n\r\n    userRate.count += 1;\r\n    rateLimitMap.set(visitorIp, userRate);\r\n\r\n    return NextResponse.json({ target, latency, status: 'Success' });\r\n  } catch (error) {\r\n    return NextResponse.json({ error: \"Gagal melakukan ping ke target\" }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,eAAe,IAAI;AACzB,MAAM,QAAQ;AACd,MAAM,cAAc,KAAK;AAElB,eAAe,IAAI,OAAgB;IACxC,IAAI,YAAY,QAAQ,OAAO,CAAC,GAAG,CAAC,sBAAsB;IAC1D,IAAI,UAAU,QAAQ,CAAC,MAAM,YAAY,UAAU,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI;IAErE,MAAM,MAAM,KAAK,GAAG;IACpB,MAAM,WAAW,aAAa,GAAG,CAAC,cAAc;QAAE,OAAO;QAAG,aAAa;IAAI;IAE7E,IAAI,MAAM,SAAS,WAAW,GAAG,aAAa;QAC5C,SAAS,KAAK,GAAG;QACjB,SAAS,WAAW,GAAG;IACzB;IAEA,IAAI,SAAS,KAAK,IAAI,OAAO;QAC3B,MAAM,aAAa,KAAK,IAAI,CAAC,CAAC,SAAS,WAAW,GAAG,cAAc,GAAG,IAAI;QAC1E,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAA8B;QAAW,GAAG;YAAE,QAAQ;QAAI;IAC9F;IAEA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,IAAI,SAAS,aAAa,GAAG,CAAC,WAAW,QAAQ,gBAAgB,IAAI,MAAM,IAAI,CAAC,EAAE,CAAC;IAEnF,IAAI,CAAC,QAAQ,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAqB,GAAG;QAAE,QAAQ;IAAI;IAErF,IAAI;QACF,MAAM,QAAQ,YAAY,GAAG;QAC7B,sDAAsD;QACtD,MAAM,aAAa,IAAI;QACvB,MAAM,KAAK,WAAW,IAAM,WAAW,KAAK,IAAI;QAEhD,MAAM,MAAM,CAAC,OAAO,EAAE,QAAQ,EAAE;YAAE,MAAM;YAAW,QAAQ,WAAW,MAAM;QAAC,GAAG,KAAK,CAAC,KAAO;QAE7F,aAAa;QACb,MAAM,MAAM,YAAY,GAAG;QAC3B,MAAM,UAAU,KAAK,KAAK,CAAC,MAAM;QAEjC,SAAS,KAAK,IAAI;QAClB,aAAa,GAAG,CAAC,WAAW;QAE5B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;YAAQ;YAAS,QAAQ;QAAU;IAChE,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiC,GAAG;YAAE,QAAQ;QAAI;IACtF;AACF"}}]
}