{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tuf/Documents/APPS/IDnity%20Tools%20v2/idnity-tools/app/api/port-scanner/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport net from 'net';\r\n\r\nconst rateLimitMap = new Map<string, { count: number; lastRequest: number }>();\r\nconst LIMIT = 3; \r\nconst WINDOW_TIME = 60 * 1000; \r\n\r\n// Daftar port umum untuk dicek\r\nconst COMMON_PORTS = [\r\n  { port: 21, service: 'FTP' },\r\n  { port: 22, service: 'SSH' },\r\n  { port: 25, service: 'SMTP' },\r\n  { port: 80, service: 'HTTP' },\r\n  { port: 110, service: 'POP3' },\r\n  { port: 143, service: 'IMAP' },\r\n  { port: 443, service: 'HTTPS' },\r\n  { port: 3306, service: 'MySQL' },\r\n  { port: 8080, service: 'HTTP-Alt' }\r\n];\r\n\r\nasync function checkPort(host: string, port: number): Promise<boolean> {\r\n  return new Promise((resolve) => {\r\n    const socket = new net.Socket();\r\n    socket.setTimeout(2000); // Timeout 2 detik\r\n\r\n    socket.on('connect', () => {\r\n      socket.destroy();\r\n      resolve(true);\r\n    });\r\n\r\n    socket.on('timeout', () => {\r\n      socket.destroy();\r\n      resolve(false);\r\n    });\r\n\r\n    socket.on('error', () => {\r\n      socket.destroy();\r\n      resolve(false);\r\n    });\r\n\r\n    socket.connect(port, host);\r\n  });\r\n}\r\n\r\nexport async function GET(request: Request) {\r\n  let visitorIp = request.headers.get('x-forwarded-for') || '127.0.0.1';\r\n  if (visitorIp.includes(',')) visitorIp = visitorIp.split(',')[0].trim();\r\n\r\n  const now = Date.now();\r\n  const userRate = rateLimitMap.get(visitorIp) || { count: 0, lastRequest: now };\r\n\r\n  if (now - userRate.lastRequest > WINDOW_TIME) {\r\n    userRate.count = 0;\r\n    userRate.lastRequest = now;\r\n  }\r\n\r\n  if (userRate.count >= LIMIT) {\r\n    const retryAfter = Math.ceil((userRate.lastRequest + WINDOW_TIME - now) / 1000);\r\n    return NextResponse.json({ error: \"Terlalu banyak permintaan.\", retryAfter }, { status: 429 });\r\n  }\r\n\r\n  const { searchParams } = new URL(request.url);\r\n  const target = searchParams.get('target')?.replace(/^https?:\\/\\//, '').split('/')[0].toLowerCase();\r\n\r\n  if (!target) {\r\n    return NextResponse.json({ error: \"Target (IP/Domain) tidak valid\" }, { status: 400 });\r\n  }\r\n\r\n  try {\r\n    const results = await Promise.all(\r\n      COMMON_PORTS.map(async (p) => {\r\n        const isOpen = await checkPort(target, p.port);\r\n        return { ...p, status: isOpen ? 'Open' : 'Closed' };\r\n      })\r\n    );\r\n\r\n    userRate.count += 1;\r\n    rateLimitMap.set(visitorIp, userRate);\r\n\r\n    return NextResponse.json({ target, results });\r\n  } catch (error) {\r\n    return NextResponse.json({ error: \"Gagal melakukan pemindaian port\" }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,eAAe,IAAI;AACzB,MAAM,QAAQ;AACd,MAAM,cAAc,KAAK;AAEzB,+BAA+B;AAC/B,MAAM,eAAe;IACnB;QAAE,MAAM;QAAI,SAAS;IAAM;IAC3B;QAAE,MAAM;QAAI,SAAS;IAAM;IAC3B;QAAE,MAAM;QAAI,SAAS;IAAO;IAC5B;QAAE,MAAM;QAAI,SAAS;IAAO;IAC5B;QAAE,MAAM;QAAK,SAAS;IAAO;IAC7B;QAAE,MAAM;QAAK,SAAS;IAAO;IAC7B;QAAE,MAAM;QAAK,SAAS;IAAQ;IAC9B;QAAE,MAAM;QAAM,SAAS;IAAQ;IAC/B;QAAE,MAAM;QAAM,SAAS;IAAW;CACnC;AAED,eAAe,UAAU,IAAY,EAAE,IAAY;IACjD,OAAO,IAAI,QAAQ,CAAC;QAClB,MAAM,SAAS,IAAI,0GAAG,CAAC,MAAM;QAC7B,OAAO,UAAU,CAAC,OAAO,kBAAkB;QAE3C,OAAO,EAAE,CAAC,WAAW;YACnB,OAAO,OAAO;YACd,QAAQ;QACV;QAEA,OAAO,EAAE,CAAC,WAAW;YACnB,OAAO,OAAO;YACd,QAAQ;QACV;QAEA,OAAO,EAAE,CAAC,SAAS;YACjB,OAAO,OAAO;YACd,QAAQ;QACV;QAEA,OAAO,OAAO,CAAC,MAAM;IACvB;AACF;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI,YAAY,QAAQ,OAAO,CAAC,GAAG,CAAC,sBAAsB;IAC1D,IAAI,UAAU,QAAQ,CAAC,MAAM,YAAY,UAAU,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI;IAErE,MAAM,MAAM,KAAK,GAAG;IACpB,MAAM,WAAW,aAAa,GAAG,CAAC,cAAc;QAAE,OAAO;QAAG,aAAa;IAAI;IAE7E,IAAI,MAAM,SAAS,WAAW,GAAG,aAAa;QAC5C,SAAS,KAAK,GAAG;QACjB,SAAS,WAAW,GAAG;IACzB;IAEA,IAAI,SAAS,KAAK,IAAI,OAAO;QAC3B,MAAM,aAAa,KAAK,IAAI,CAAC,CAAC,SAAS,WAAW,GAAG,cAAc,GAAG,IAAI;QAC1E,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAA8B;QAAW,GAAG;YAAE,QAAQ;QAAI;IAC9F;IAEA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,SAAS,aAAa,GAAG,CAAC,WAAW,QAAQ,gBAAgB,IAAI,MAAM,IAAI,CAAC,EAAE,CAAC;IAErF,IAAI,CAAC,QAAQ;QACX,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiC,GAAG;YAAE,QAAQ;QAAI;IACtF;IAEA,IAAI;QACF,MAAM,UAAU,MAAM,QAAQ,GAAG,CAC/B,aAAa,GAAG,CAAC,OAAO;YACtB,MAAM,SAAS,MAAM,UAAU,QAAQ,EAAE,IAAI;YAC7C,OAAO;gBAAE,GAAG,CAAC;gBAAE,QAAQ,SAAS,SAAS;YAAS;QACpD;QAGF,SAAS,KAAK,IAAI;QAClB,aAAa,GAAG,CAAC,WAAW;QAE5B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;YAAQ;QAAQ;IAC7C,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAkC,GAAG;YAAE,QAAQ;QAAI;IACvF;AACF"}}]
}